-- public.picture source

CREATE OR REPLACE VIEW public.picture
AS SELECT media,
    thumbnail,
    checksumpicture,
    mimetype
   FROM pictures t1;

-- Permissions

ALTER TABLE public.picture OWNER TO "admin";
GRANT ALL ON TABLE public.picture TO "admin";
GRANT ALL ON TABLE public.valbums TO admin_album_role;
GRANT SELECT ON TABLE public.picture TO read_album_role;

-- public.valbums source
ALTER TABLE public.albums ADD "locked" bool DEFAULT false NOT NULL;
ALTER TABLE public.albums ADD collection bool DEFAULT false NOT NULL;

-- public.valbums source

CREATE OR REPLACE VIEW public.valbums
AS SELECT id,
    title,
    published,
    thumbnailhash,
    locked,
    key
   FROM albums tn
  WHERE title::text <> 'Default Album'::text;

-- Permissions

ALTER TABLE public.valbums OWNER TO "admin";
GRANT ALL ON TABLE public.valbums TO "admin";
GRANT SELECT ON TABLE public.valbums TO admin_album_role;
GRANT SELECT ON TABLE public.valbums TO read_album_role;

INSERT INTO public.batch_repo ("name",query,paramcount,"database") VALUES
	 ('picSearch',decode('53454C45435420636865636B73756D706963747572652C736861323536636865636B73756D2C4D494D45747970652C6F7074696F6E732C657869667864696D656E73696F6E2C657869667964696D656E73696F6E2C657869666F7269656E746174696F6E2C6865696768742C77696474682C657869666D6F64656C2C657869666D616B652C657869666F72696774696D652C637265617465642C757064617465645F61742C6578696674616B656E2C6D696D65747970652C7469746C652046524F4D2070696374757265732020743120205748455245206578696674616B656E3E3D243120414E44206578696674616B656E3C243220414E4420206D61726B64656C6574653D243320414E44206D696D6574797065204C494B452027696D6167652F25252720414E44204E4F54204558495354532873656C65637420312046524F4D207069637475726574616773202074322057484552452074312E636865636B73756D706963747572653D74322E636865636B73756D7069637475726529204F52444552204259202434204C494D49542024350A','hex'),5,'pictures'),
	 ('picSearchDyn',decode('73656C6563740A09636865636B73756D706963747572652C0A09736861323536636865636B73756D2C0A094D494D45747970652C0A096F7074696F6E732C0A09657869667864696D656E73696F6E2C0A09657869667964696D656E73696F6E2C0A09657869666F7269656E746174696F6E2C0A096865696768742C0A0977696474682C0A09657869666D6F64656C2C0A09657869666D616B652C0A09657869666F72696774696D652C0A09637265617465642C0A09757064617465645F61742C0A096578696674616B656E2C0A096D696D65747970652C0A097469746C652C0A096770736C617469747564652C0A096770736C6F6E6769747564652C0A09636F756E74282A29204F564552282920415320746F74616C5F636F756E740A66726F6D0A0970696374757265732074310A77686572650A093C77686572653E0A6F726465722062790A093C6F726465723E0A6C696D6974203C6C696D69743E0A','hex'),5,'pictures'),
	 ('picSearchDynJoin',decode('73656C6563740A092A2C0A20202020636F756E74282A29204F564552282920415320746F74616C5F636F756E740A66726F6D0A0976736561726368706963746167732074310A77686572650A093C77686572653E0A0A6F726465722062790A093C6F726465723E0A6C696D6974203C6C696D69743E','hex'),5,'pictures'),
	 ('albumSearch',decode('53454C4543540A092A0A46524F4D0A0976616C62756D7320746E0A4F524445522042590A093C6F726465723E0A4C494D4954203C6C696D69743E','hex'),2,'valbums'),
	 ('picSearchTag',decode('73656C656374202A2C20636F756E74282A29204F564552282920415320746F74616C5F636F756E740A66726F6D20767365617263687069637461677320746E200A77686572650A093C77686572653E0A6F726465722062790A093C6F726465723E0A6C696D6974203C6C696D69743E','hex'),5,'pictures'),
	 ('albumSearch2',decode('53454C4543540A0949442C0A095469746C652C0A097075626C69736865642C0A095468756D626E61696C486173680A46524F4D0A09416C62756D7320746E0A57484552450A20205469746C6520213D202744656661756C7420416C62756D270A4F524445522042590A093C6F726465723E0A4C494D4954203C6C696D69743E','hex'),1,'Albums'),
	 ('SearchDoublikates',decode('73656C6563740A09636F756E742868617368292C0A09686173680A66726F6D0A09706963747572656861736820700A77686572650A09657869737473280A0973656C6563740A0909310A0966726F6D0A090970696374757265732070700A0977686572650A090970702E636865636B73756D70696374757265203D20702E636865636B73756D706963747572650A0909616E642070702E6D61726B64656C657465203D2066616C7365290A67726F75702062790A09686173680A686176696E670A09636F756E74286861736829203E20310A6F726465722062790A09636F756E7420646573630A6C696D69742032350A','hex'),0,'picturehash'),
	 ('picSearchByTag',decode('73656C6563740A09702E636865636B73756D706963747572652C0A09736861323536636865636B73756D2C0A094D494D45747970652C0A096F7074696F6E732C0A09657869667864696D656E73696F6E2C0A09657869667964696D656E73696F6E2C0A09657869666F7269656E746174696F6E2C0A096865696768742C0A0977696474682C0A09657869666D6F64656C2C0A09657869666D616B652C0A09657869666F72696774696D652C0A09637265617465642C0A09757064617465645F61742C0A096578696674616B656E2C0A096D696D65747970652C0A097469746C650A66726F6D0A09706963747572657320702C0A09280A0973656C6563740A0909636865636B73756D706963747572650A0966726F6D0A090970696374757265746167730A0977686572650A09097461676E616D65206C696B6520273C7461676E616D653E272920630A77686572650A09702E636865636B73756D70696374757265203D20632E636865636B73756D706963747572650A09616E64206D61726B64656C657465203D2066616C7365','hex'),1,'pictures'),
	 ('picSearchDynJoin2',decode('73656C6563740A09636865636B73756D706963747572652C0A09736861323536636865636B73756D2C0A094D494D45747970652C0A096F7074696F6E732C0A096D61726B64656C6574652C0A09657869667864696D656E73696F6E2C0A09657869667964696D656E73696F6E2C0A09657869666F7269656E746174696F6E2C0A096865696768742C0A0977696474682C0A09657869666D6F64656C2C0A09657869666D616B652C0A09657869666F72696774696D652C0A09637265617465642C0A09757064617465645F61742C0A096578696674616B656E2C0A096D696D65747970652C0A096770736C617469747564652C0A096770736C6F6E6769747564652C0A097469746C652C0A09535452494E475F4147472028612E7461676E616D652C272C270A2020202020206F726465722062790A092020612E7461676E616D650A202020202920746167732C0A20202020636F756E74282A29204F564552282920415320746F74616C5F636F756E742C0A202020202853454C4543542070682E70657263657074696F6E686173682046524F4D2070696374757265686173682070682057484552452070682E636865636B73756D70696374757265203D2074312E636865636B73756D7069637475726520204C494D495420312920415320686173680A66726F6D0A0970696374757265732074310A6C656674206A6F696E20706963747572657461677320610A09097573696E672028636865636B73756D70696374757265290A77686572650A093C77686572653E0A67726F75702062790A09636865636B73756D706963747572652C736861323536636865636B73756D2C094D494D45747970652C0A096F7074696F6E732C0A096D61726B64656C6574652C0A09657869667864696D656E73696F6E2C0A09657869667964696D656E73696F6E2C0A09657869666F7269656E746174696F6E2C0A096865696768742C0A0977696474682C0A09657869666D6F64656C2C0A09657869666D616B652C0A09657869666F72696774696D652C0A09637265617465642C0A09757064617465645F61742C0A096578696674616B656E2C0A096D696D65747970652C0A096770736C617469747564652C0A096770736C6F6E6769747564652C0A097469746C650A6F726465722062790A093C6F726465723E0A6C696D6974203C6C696D69743E','hex'),5,'pictures');
